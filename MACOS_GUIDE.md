# 🍎 macOS 使用指南

針對 macOS 使用者的特別說明和設定。

---

## 🖥️ 多桌面（Mission Control）注意事項

### PyAutoGUI 的限制

**重要**：PyAutoGUI 只能截取**當前活動桌面**的內容！

❌ **不可行的情況**：
- 遊戲在桌面 2，程式在桌面 1 → 程式看不到遊戲
- 遊戲視窗被其他視窗遮擋 → 程式看不到被遮擋的部分
- 遊戲在背景，其他視窗在前景 → 程式看不到遊戲

✅ **必須確保**：
- 遊戲和終端機在**同一個桌面**
- 遊戲視窗**完全可見**（不被遮擋）
- 遊戲視窗在**最前面**或至少盤面區域可見

---

## 🎯 推薦的工作環境設定

### 方案 1：並排視窗（推薦）

**優點**：可以同時看到程式輸出和遊戲畫面

```
┌─────────────────────────────────────────┐
│                                         │
│  ┌──────────────┐  ┌─────────────────┐ │
│  │ 終端機       │  │  Chrome         │ │
│  │              │  │                 │ │
│  │ $ python ... │  │  ┌───────────┐  │ │
│  │              │  │  │ 遊戲盤面  │  │ │
│  │ [視覺] ...   │  │  │ 🔴🔵🟢   │  │ │
│  │              │  │  └───────────┘  │ │
│  └──────────────┘  └─────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
```

**設定步驟**：
1. 調整 `config.py` 中的視窗大小：
   ```python
   USE_CUSTOM_WINDOW_SIZE = True
   WINDOW_X = 600           # 視窗在螢幕右側
   WINDOW_Y = 0
   WINDOW_WIDTH = 1200      # 佔右半邊螢幕
   WINDOW_HEIGHT = 900
   ```

2. 執行程式後，瀏覽器會自動出現在右側

3. 終端機放在左側

### 方案 2：Split View（macOS 內建）

**優點**：視窗大小固定，不會亂動

**設定步驟**：
1. 手動開啟 Chrome，進入遊戲
2. 長按綠色全螢幕按鈕 → 選擇「向左平鋪視窗」或「向右平鋪視窗」
3. 選擇終端機作為另一半
4. 執行測試程式

**注意**：如果使用這個方案，`config.py` 中設定：
```python
USE_CUSTOM_WINDOW_SIZE = False  # 不使用自動視窗調整
```

### 方案 3：單一大視窗（適合測試）

**步驟**：
1. 把遊戲視窗調大（但不全螢幕）
2. 確保遊戲盤面完全可見
3. 終端機可以在背景（看不到沒關係）

---

## 🔧 視窗位置微調

### 找出你的最佳視窗設定

1. **手動調整瀏覽器視窗**到你喜歡的位置和大小

2. **執行這個 Python 指令**來查看當前視窗的資訊：
   ```bash
   python -c "import pyautogui; print('螢幕大小:', pyautogui.size())"
   ```

3. **建議的設定值**：

   **13 吋 MacBook**：
   ```python
   WINDOW_X = 400
   WINDOW_Y = 0
   WINDOW_WIDTH = 1000
   WINDOW_HEIGHT = 800
   ```

   **15-16 吋 MacBook**：
   ```python
   WINDOW_X = 600
   WINDOW_Y = 0
   WINDOW_WIDTH = 1200
   WINDOW_HEIGHT = 900
   ```

   **外接大螢幕**：
   ```python
   WINDOW_X = 800
   WINDOW_Y = 100
   WINDOW_WIDTH = 1400
   WINDOW_HEIGHT = 1000
   ```

---

## 🎮 測試流程（macOS 專用）

### 步驟 1：測試視窗位置

```bash
python game_launcher.py
```

檢查：
- ✅ 瀏覽器是否在你期望的位置？
- ✅ 大小是否適中？
- ✅ 遊戲盤面是否完全可見？

如果不滿意，調整 `config.py` 的 `WINDOW_X`, `WINDOW_Y`, `WINDOW_WIDTH`, `WINDOW_HEIGHT`

### 步驟 2：測試視覺辨識

**重要**：確保遊戲視窗在最前面！

```bash
# 1. 開啟遊戲（任何瀏覽器）
# 2. 確保遊戲完全可見
# 3. 執行測試
python vision_module.py
```

按 Enter 前，**確認**：
- ✅ 遊戲視窗在當前桌面
- ✅ 遊戲視窗沒有被遮擋
- ✅ 遊戲盤面清晰可見

---

## 🐛 macOS 特定問題

### 問題 1：截圖權限

**症狀**：程式無法截圖或找不到遊戲

**解決**：
1. 系統偏好設定 → 安全性與隱私權
2. 隱私權 → 螢幕錄製
3. 確認「終端機」或你的 IDE 有權限
4. 如果沒有，勾選後重新啟動程式

### 問題 2：視窗大小無法設定

**症狀**：`set_window_position()` 沒有作用

**解決**：
1. macOS 的視窗管理可能限制程式控制
2. **改用手動調整**：
   ```python
   USE_CUSTOM_WINDOW_SIZE = False
   ```
3. 手動把瀏覽器視窗放到合適位置

### 問題 3：Retina 顯示器座標問題

**症狀**：截圖看起來糊糊的，或座標不對

**解決**：
- macOS Retina 顯示器使用 2x 縮放
- PyAutoGUI 會自動處理，但如果有問題：
  ```python
  # 在 config.py 加入
  import platform
  if platform.system() == 'Darwin':  # macOS
      CELL_SIZE = CELL_SIZE * 2  # 根據需要調整
  ```

### 問題 4：多顯示器設定

**症狀**：有外接螢幕，不知道用哪個

**建議**：
1. 使用**主顯示器**（通常是 MacBook 內建螢幕）
2. 確保遊戲在主顯示器上
3. 或者：拔掉外接螢幕來測試

---

## 🔍 除錯技巧（macOS）

### 確認截圖是否正確

在 `vision_module.py` 中，加入這段測試：

```python
# 測試截圖
screenshot = pyautogui.screenshot()
screenshot.save('test_screenshot.png')
print("截圖已儲存為 test_screenshot.png，請檢查是否正確")
```

打開 `test_screenshot.png`，確認：
- ✅ 是否包含遊戲畫面？
- ✅ 畫面是否清晰？
- ✅ 是否是當前桌面的內容？

---

## 💡 最佳實踐

### 開發時
1. **使用並排視窗**，方便觀察
2. **開啟 DEBUG_MODE**，看到每一步
3. **頻繁檢查除錯圖片**

### 錄影時
1. **使用較大的遊戲視窗**，讓觀眾看清楚
2. **確保終端機輸出也入鏡**（可以顯示程式邏輯）
3. **考慮使用 Split View**，畫面更穩定

### 提交前
1. **測試多次**確保穩定
2. **檢查除錯圖片**是否正確
3. **確認視窗設定**在你的 MacBook 上可重現

---

## 📝 快速檢查清單

執行程式前，確認：
- [ ] 遊戲和終端機在**同一個桌面**
- [ ] 遊戲視窗**完全可見**
- [ ] 已設定好 `config.py` 的視窗參數
- [ ] 已準備好 `reference_icon.png`
- [ ] 已給予終端機**螢幕錄製權限**
- [ ] 已安裝所有套件（包括 opencv-python）

---

## 🎓 推薦設定範例

**我的 MacBook Pro 16" 設定**：
```python
# config.py
USE_CUSTOM_WINDOW_SIZE = True
WINDOW_X = 800
WINDOW_Y = 0
WINDOW_WIDTH = 1200
WINDOW_HEIGHT = 900
```

**終端機**：放在左側，寬度約 800px

**效果**：
- 左側看到程式輸出
- 右側看到遊戲執行
- 完美！

---

## 🆘 還是不行？

如果你遇到 macOS 特有的問題：

1. **檢查系統權限**
2. **試試手動調整視窗**（設定 `USE_CUSTOM_WINDOW_SIZE = False`）
3. **確保只使用一個桌面**
4. **確保遊戲在最前面**
5. **重新截取參考圖示**（可能尺寸不對）

---

**macOS 的視窗管理確實比較複雜，但只要遵循這些建議，應該就沒問題了！** 🍎💪
