# 📸 如何準備參考圖示

參考圖示是程式能夠自動定位遊戲盤面的關鍵！

---

## 為什麼需要參考圖示？

程式需要知道遊戲盤面在螢幕上的位置。透過尋找一個**獨特且固定的介面元素**，程式就能計算出盤面的位置。

---

## 步驟 1: 開啟遊戲

1. 前往 https://www.crazygames.com/game/collect-em-all
2. 等待遊戲完全載入
3. **確保遊戲視窗是全螢幕或固定大小**

---

## 步驟 2: 選擇參考元素

### ✅ 好的選擇

選擇這些**固定不變**的 UI 元素：

1. **遊戲標題/Logo**
   - 通常在遊戲上方
   - 不會改變
   - 獨特且易識別

2. **分數顯示區域的框**
   - 注意：截取「框」而非分數數字
   - 分數數字會變，框不會變

3. **計時器的圖示**
   - 圖示固定，數字可變

4. **按鈕或控制項**
   - 如：設定按鈕、暫停按鈕

### ❌ 不好的選擇

避免這些**會變化**的元素：

1. ❌ 分數的數字（會變）
2. ❌ 遊戲盤面的球（會變）
3. ❌ 動畫效果（會變）
4. ❌ 廣告區域（可能變）

---

## 步驟 3: 截取圖示

### Windows 使用者

**方法 1: Snipping Tool**
1. 按 `Win + Shift + S`
2. 拖曳選擇參考元素
3. 圖片會自動複製到剪貼簿
4. 開啟小畫家，貼上並儲存為 `reference_icon.png`

**方法 2: 截圖工具**
1. 搜尋「截圖工具」或「Snipping Tool」
2. 選擇「新增」
3. 框選參考元素
4. 儲存為 `reference_icon.png`

### Mac 使用者

1. 按 `Cmd + Shift + 4`
2. 拖曳選擇參考元素
3. 圖片會自動儲存到桌面
4. 重新命名為 `reference_icon.png`

---

## 步驟 4: 調整圖片

### 建議大小

- **最佳**: 50x50 到 100x100 像素
- **可接受**: 30x30 到 150x150 像素
- **不建議**: 超過 200x200 像素（太大會變慢）

### 如何調整大小

**Windows - 使用小畫家**:
1. 開啟圖片
2. 點選「調整大小」
3. 取消勾選「維持外觀比例」
4. 輸入寬度和高度（如：80x80）
5. 儲存

**Mac - 使用預覽程式**:
1. 開啟圖片
2. 工具 → 調整大小
3. 輸入寬度和高度
4. 儲存

---

## 步驟 5: 放置圖片

將 `reference_icon.png` 放到專案的 `assets/` 資料夾：

```
collect_em_all_bot/
└── assets/
    └── reference_icon.png  ← 放這裡
```

---

## 步驟 6: 測試

執行測試程式：

```bash
python vision_module.py
```

如果看到：
```
[視覺] 盤面定位成功！位置: (450, 280)
```

就表示成功了！✅

如果看到：
```
[錯誤] 找不到參考圖示！
```

請繼續下面的調整步驟。

---

## 🔧 調整技巧

### 問題 1: 找不到參考圖示

**可能原因 1**: 遊戲介面改變了
- **解決**: 確保截圖時和執行程式時的遊戲介面一致

**可能原因 2**: 圖片太相似找不到精確匹配
- **解決**: 在 `config.py` 中降低 `MATCH_CONFIDENCE`
  ```python
  MATCH_CONFIDENCE = 0.7  # 從 0.8 降到 0.7
  ```

**可能原因 3**: 截圖包含太多變化的內容
- **解決**: 重新截取更簡單、更固定的元素

### 問題 2: 定位到錯誤的位置

**原因**: 偏移量設定錯誤

**解決**: 調整 `config.py` 中的 `BOARD_OFFSET_FROM_REFERENCE`

**如何測量正確的偏移量？**

1. 執行測試後，開啟 `assets/debug/01_board_location.png`
2. 查看紅色框選是否正確
3. 如果不正確，估算需要偏移的像素數：
   - 如果框太上面 → 增加 y 偏移
   - 如果框太下面 → 減少 y 偏移
   - 如果框太左邊 → 增加 x 偏移
   - 如果框太右邊 → 減少 x 偏移

例如：
```python
# 原本
BOARD_OFFSET_FROM_REFERENCE = (50, 100)

# 框太左邊、太上面
BOARD_OFFSET_FROM_REFERENCE = (100, 150)  # 增加偏移

# 框太右邊、太下面
BOARD_OFFSET_FROM_REFERENCE = (20, 50)    # 減少偏移
```

---

## 📝 範例

### 好的參考圖示範例

假設遊戲介面長這樣：

```
┌─────────────────────────────┐
│  [⚙️]  COLLECT EM ALL!  [🔊]  │ ← 這個標題列很好
├─────────────────────────────┤
│  Score: 1250   Time: 45s    │ ← "Score:" 文字也不錯
├─────────────────────────────┤
│                             │
│      🔴 🔵 🟢 🔵 🟡       │
│      🔵 🔵 🟢 🟢 🟢       │ ← 這是遊戲盤面（會變）
│      🔴 🟡 🔴 🟢 🔵       │
│                             │
└─────────────────────────────┘
```

**建議截取**:
- ✅ "COLLECT EM ALL!" 標題
- ✅ 設定圖示 ⚙️
- ✅ "Score:" 文字標籤
- ❌ 分數數字 "1250"（會變）
- ❌ 遊戲球（會變）

---

## 🎯 檢查清單

準備參考圖示前，確認：
- [ ] 遊戲已完全載入
- [ ] 選擇的元素不會改變
- [ ] 選擇的元素是獨特的
- [ ] 圖片大小適中（50-100px）
- [ ] 圖片清晰無模糊
- [ ] 儲存為 PNG 格式
- [ ] 檔名正確：`reference_icon.png`
- [ ] 放在 `assets/` 資料夾

---

## 💡 進階技巧

### 使用多個參考點

如果單一參考圖示不穩定，可以在程式中實作多個備用參考點：

```python
# 在 vision_module.py 中
REFERENCE_IMAGES = [
    "assets/reference_icon_1.png",
    "assets/reference_icon_2.png",
    "assets/reference_icon_3.png"
]

def locate_game_board():
    for ref_image in REFERENCE_IMAGES:
        location = pyautogui.locateOnScreen(ref_image, confidence=0.8)
        if location:
            return calculate_board_position(location)
    return None
```

---

## ❓ 常見問題

**Q: 我可以用遊戲盤面的一角作為參考嗎？**

A: 不建議。盤面上的球會不斷變化，即使是邊角也可能因為顏色變化而難以匹配。

**Q: 參考圖示需要很精確嗎？**

A: 不需要完美，但要能清楚識別。一個約 80x80 的清晰圖示就足夠了。

**Q: 我可以截取整個遊戲視窗嗎？**

A: 不建議。太大的圖片會讓搜尋變慢，而且不夠精確。

**Q: 參考圖示找不到時該怎麼辦？**

A: 
1. 降低 `MATCH_CONFIDENCE`
2. 重新截取更簡單的元素
3. 確保遊戲介面一致
4. 檢查圖片格式是否為 PNG

---

**記住：好的參考圖示是專案成功的關鍵！花點時間選擇正確的元素很值得。** 🎯
